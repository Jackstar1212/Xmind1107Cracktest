(global.webpackChunkxmind_vana=global.webpackChunkxmind_vana||[]).push([[5536],{12147:(e,t,r)=>{"use strict";var o=r(95318);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var n=o(r(59713)),a=o(r(17863)),i=o(r(87489)),s=o(r(71191)),l=r(20629),c=r(36414),u=r(99492),d=o(r(41698)),p=r(83450),h=r(74627),m=o(r(24678)),b=r(58933),f=o(r(7322)),w=r(1893),v=r(48932),k=o(r(2286));function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const C=(0,d.default)("new"),{Menu:T,MenuItem:O}=b.remote;var x={components:{PreviewSection:a.default,SkeletonPreview:i.default},mixins:[f.default],data:()=>({activeTab:"new",callbackEndpoints:null,selectedTheme:null,libraryItemsLoaded:!1,selectedLibraryId:null,isDownloading:!1,selectedColorThemeId:null}),computed:y(y(y(y({},(0,l.mapState)("cache",["libraryItems"])),(0,l.mapState)("theme",["recentlyUsedColorThemeIds"])),(0,l.mapGetters)("app",["serviceRegion"])),{},{availableTabs(){this.$store.getters["activation/status"],v.ACTIVATION_STATUS.VALID,this.$store.getters["activation/hasRawPerMachineLicenseDataValidated"];return["new","library"]},touchBarItems(){return["new"===this.activeTab?{type:"button",label:this.$T("Open File"),click:"openExistingFile"}:null,{type:"space",size:"flexible"},{type:"button",label:this.$T("Cancel"),click:"close"},"new"===this.activeTab?{type:"button",label:this.$T("Create"),backgroundColor:"primary",click:"createFromSelectedTheme"}:{type:"button",label:this.$T("Open"),backgroundColor:"primary",click:"createFromLibrary"},{type:"space",size:"flexible"}].filter(Boolean)},activeTabIndex(){return this.availableTabs.indexOf(this.activeTab)},recentFileItems(){const e=[];for(let{source:t}of this.$store.state.editors.recentlyOpenedItems.slice(0,10)){(0,w.getLocalFileNameFromUri)(t)&&e.push({name:(0,w.getLocalFileNameFromUri)(t),source:t})}return e},libraryItemsPreviews(){return[{label:"Gallery",items:this.libraryItems}]},isMAS:()=>!1,colorList(){return this.selectedColorThemeId?(0,h.getThemeColorListById)(this.selectedColorThemeId):[]},computedColorThemeList(){const e=[...this.recentlyUsedColorThemeIds];if(!e||!Array.isArray(e))return;const t=e.reverse().map((e=>{const t=this.getColorThemePreviewURL(e);return t?{id:e,previewURL:t}:null})).filter(Boolean);return[{label:this.$T("Recently Used"),items:t,toggleDisabled:!0},...this.colorThemeItems]},colorThemeItems(){const e=this.$store.getters["preferences/language"];return(0,h.getColorThemeOrderInfo)(e).map((e=>({label:e.themeName,uiName:e.uiName,items:e.idList.map((e=>({id:e,previewURL:this.getColorThemePreviewURL(e)})))})))}}),methods:y(y({},(0,l.mapMutations)({updateLibraryItems:"cache/updateLibraryItems"})),{},{handleOpenMenu(){const e=new T;for(let t of this.recentFileItems)e.append(new O({label:t.name,click:async()=>{t&&(await this.$store.handleCommand("openRecentFileItem",[t.source]),k.default.existsSync((0,w.urlToFilePath)(t.source))&&window.close())}}));0!==this.recentFileItems.length?(e.append(new O({type:"separator"})),e.append(new O({label:this.$T("Clear Menu"),click:()=>{this.$store.handleCommand("cleanRecent")}}))):e.append(new O({label:this.$T("Clear Menu"),enabled:!1})),e.popup({window:b.remote.getCurrentWindow()})},createFromSelectedTheme(){const e=this.selectedTheme;if(!e)return!1;const t=`new://workbook?skeleton=${encodeURIComponent(e.id)}&template=${encodeURIComponent(e.template)}&title=${encodeURIComponent(e.name)}&structure=${encodeURIComponent(e.structureClass)}&colortheme=${encodeURIComponent(this.selectedColorThemeId)}`;return window.hide(),this.$safeRun((()=>Promise.all([m.default.fetch(u.EDITOR_OPEN,{source:t}),(0,p.trackEvent)({eventAction:"newSkeleton",eventname:this.selectedTheme.id}),(0,p.trackEvent)({eventAction:"newColor",eventname:this.selectedColorThemeId}),(0,p.trackEvent)({eventCategory:"NewPanel",eventAction:"chooseThemeFromNewWindow",eventName:e.name})]).then((()=>{window.close()})))).catch((()=>{window.close()})),!1},createFromLibrary(){const e=this.selectedLibraryId;if(e&&!this.isDownloading)return this.isDownloading=!0,m.default.fetch(u.XOS.LIBRARY_DOWNLOAD,{id:e}).then((e=>{this.isDownloading=!1,m.default.fetch(u.EDITOR_OPEN,{source:e}).then((()=>{window.close()}))})).catch((t=>{this.isDownloading=!1,C.error("Failed to download workbook from library:",e,(0,c.normalizeError)(t))})),!1},openExistingFile(){this.$store.handleCommand("open"),(0,p.trackEvent)({eventCategory:"NewPanel",eventAction:"openExist"})},openMoreMaps(){m.default.fetch(u.XOS.GO_LIBRARY_MORE_MAPS),(0,p.trackEvent)({eventCategory:"NewPanel",eventAction:"jumpToMore"})},cancel(){window.close()},async refreshLibraryItems(){try{let e=(await m.default.fetch(u.XOS.LIBRARY_ITEMS)).map(((e,t)=>{const r=e.thumbnailUrl.replace(/^https/,"cache");return t<6&&m.default.fetch(u.XOS.FILE_DOWNLOAD,{downloadUrl:r,filename:(0,c.HASH)(r)}).catch((()=>{})),{name:"string"==typeof e.topic&&e.topic.trim(),previewURL:r,id:e.id}}));this.updateLibraryItems({libraryItems:e})}catch(e){C.error("Failed to get library items:",(0,c.normalizeError)(e))}},async popoverClick(){if(!this.$refs.windowTitleBar)return;this.$refs.windowTitleBar.classList.add("popover-on"),(0,p.trackEvent)({eventAction:"clickNewColor"}),await new Promise((e=>setTimeout(e,100)));const e=document.querySelector(".uk-pop-overlay");e&&e.addEventListener("mousedown",(()=>this.$refs.windowTitleBar.classList.remove("popover-on")))},onColorThemeSelect(e){this.selectedColorThemeId=e,this.$store.commit("theme/appendRecentlyUsedColorTheme",e)},getColorThemePreviewURL(e){const t=(0,h.getColorThemePreviewById)(e,h.snowballConstant.COLOR_THEME_PREVIEW_TYPE.MAP);return t?`data:image/svg+xml,${encodeURIComponent(t)}`:null}}),watch:{serviceRegion(){this.refreshLibraryItems()}},created(){this.refreshLibraryItems();const e=s.default.parse(window.location.search.slice(1));e.tab&&(this.activeTab=e.tab);const t=this.computedColorThemeList[0],r=Array.isArray(t.items)&&t.items.length?t.items[0]:null;this.selectedColorThemeId=r&&r.id||h.DEFAULT_COLOR_THEME_ID}};t.Z=x},7322:(e,t,r)=>{"use strict";var o=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(r(59713)),a=r(48932),i=r(99492),s=r(36414),l=o(r(24678));function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d={computed:{},watch:{touchBarItems(e){this.updateTouchBarItems(e)}},methods:{updateTouchBarItems(e){const t=e=>{const t=e.click;let r=this._touchBarRoutes[t];return r||(r={method:t,endpoint:(0,i.WINDOW_CALLBACK)(window.id,(0,s.hyphenate)(t))},this._touchBarRoutes[t]=r),r.unroute||(r.unroute=l.default.route(r.endpoint,this[t])),Object.assign({},e,{click:r.endpoint})};e=(e||this.touchBarItems||[]).map((e=>("button"!==e.type||"string"!=typeof e.click||a.WINDOW_ACTIONS.includes(e.click)||e.click.startsWith("command:")?"buttons"===e.type&&(e=u(u({},e),{},{buttons:e.buttons.map((e=>"string"!=typeof e.click||a.WINDOW_ACTIONS.includes(e.click)||e.click.startsWith("command:")?e:t(e)))})):e=t(e),e))),this.$store.commit("window/updateTouchBarItems",{items:e})}},beforeCreate(){this._touchBarRoutes={}},mounted(){this.updateTouchBarItems()},beforeDestroy(){Object.values(this._touchBarRoutes).forEach((({unroute:e})=>e&&e())),this._touchBarRoutes={}}};t.default=d},31952:(e,t,r)=>{"use strict";var o=r(95318),n=o(r(2872)),a=o(r(60379)),i=o(r(16641)),s=o(r(66515));(0,n.default)(s.default,{name:"new",storeModules:{fonts:a.default},storePlugins:[(0,i.default)()]})},60379:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(99492),n=r(24678);let a;var i={namespaced:!0,state:{loaded:!1},mutations:{markLoaded:e=>{e.loaded=!0}},actions:{getLoadedFonts:()=>(a||(a=(0,n.fetch)(o.GET_ALL_FONTS)),a)}};t.default=i},16641:(e,t,r)=>{"use strict";var o=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(r(59713)),a=r(78835),i=o(r(98756)),s=r(53305);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const u="static/fonts/fonts.json";t.default=()=>e=>{(async function(){let e=await(0,s.load)(u),t=JSON.parse(e),r=[];const o=(0,s.toURL)(u);for(let e in t){let n=t[e];for(let{src:t,weight:i,italic:s}of n){let n=new a.URL(t,o).toString(),l=new FontFace(e,`url("${n}")`,c({weight:i},s?{style:"italic"}:{}));document.fonts.add(l),l.load(),r.push(l.loaded)}}await Promise.all(r)})().then((()=>{e.commit("fonts/markLoaded")})).catch((e=>{throw(0,i.default)(new Error("Failed to load CSS fonts"),e)})),document.fonts.onloadingdone=()=>{e.commit("fonts/markLoaded")},document.fonts.onloadingerror=()=>{e.commit("fonts/markLoaded")}}},38417:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var o=r(94015),n=r.n(o),a=r(23645),i=r.n(a)()(n());i.push([e.id,"\n.uk-window-expanded-title-bar[data-v-44129d14] {\n  z-index: auto;\n}\n.uk-window-expanded-title-bar.popover-on[data-v-44129d14] {\n  z-index: unset;\n  -webkit-app-region: no-drag;\n}\n.main-content-tab[data-v-44129d14] {\n  height: 42px;\n}\n.theme-category-dropdown[data-v-44129d14] {\n  right: 30px;\n}\n.theme-category-dropdown > .uk-button-popover-toggle[data-v-44129d14] {\n  width: 100px;\n}\n","",{version:3,sources:["webpack://./app/renderer/pages/new/app.vue"],names:[],mappings:";AACA;EACE,aAAa;AACf;AACA;EACE,cAAc;EACd,2BAA2B;AAC7B;AACA;EACE,YAAY;AACd;AACA;EACE,WAAW;AACb;AACA;EACE,YAAY;AACd",sourcesContent:["\n.uk-window-expanded-title-bar[data-v-44129d14] {\n  z-index: auto;\n}\n.uk-window-expanded-title-bar.popover-on[data-v-44129d14] {\n  z-index: unset;\n  -webkit-app-region: no-drag;\n}\n.main-content-tab[data-v-44129d14] {\n  height: 42px;\n}\n.theme-category-dropdown[data-v-44129d14] {\n  right: 30px;\n}\n.theme-category-dropdown > .uk-button-popover-toggle[data-v-44129d14] {\n  width: 100px;\n}\n"],sourceRoot:""}]);const s=i},66515:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__esModule:()=>o.X,default:()=>a});var o=r(12147);var n=function(e){r(3387)};const a=(0,r(62236).Z)(o.Z,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"uk-window uk-window-dialog uk-window-default"},[r("div",{ref:"windowTitleBar",staticClass:"uk-window-expanded-title-bar"},[r("div",{staticClass:"uk-window-title-bar"},[r("window-control-button-group")],1),e._v(" "),r("div",{staticClass:"uk-flex uk-flex-center uk-position-relative main-content-tab",staticStyle:{"margin-top":"8px"}},[r("ul",{staticClass:"uk-tab uk-tab-large uk-flex-center uk-tab-capsule",attrs:{"uk-tab":"connect: .main-content-switcher","data-active":e.activeTabIndex}},[e.availableTabs.includes("new")?r("li",[r("a",{attrs:{draggable:"false",href:"#"},on:{click:function(t){e.activeTab="new"}}},[e._v(e._s(e.$T("New")))])]):e._e(),e._v(" "),e.availableTabs.includes("library")?r("li",[r("a",{attrs:{draggable:"false",href:"#"},on:{click:function(t){e.activeTab="library"}}},[e._v(e._s(e.$T("Library")))])]):e._e()]),e._v(" "),"new"===e.activeTab?r("div",{staticClass:"uk-position-absolute theme-category-dropdown"},[r("button",{staticClass:"uk-button uk-button-floating uk-border-rounded uk-flex-1 uk-flex uk-flex-middle",staticStyle:{"min-height":"22px","max-width":"100px","z-index":"1",padding:"0 10px"},attrs:{title:e.$T("Click to choose the color theme.")},on:{click:e.popoverClick}},[r("div",{staticClass:"uk-flex uk-overflow-hidden",staticStyle:{width:"64px","border-radius":"2px","flex-shrink":"0"}},e._l(e.colorList,(function(e,t){return r("div",{key:t,style:{width:"40px",height:"8px",background:e}})})),0),e._v(" "),r("span",{staticClass:"uk-icon",staticStyle:{"padding-left":"5px"},attrs:{focustrigger:"cannotGetFocusByMouse","uk-icon":"icon: chevron-down"}})]),e._v(" "),r("div",{staticStyle:{width:"268px"},attrs:{"uk-popover":"","data-sel-close":"[uk-menu] > li > button"}},[r("ul",{staticClass:"uk-overflow-auto uk-flex uk-flex-column ",style:{height:"514px",margin:0,padding:0}},[r("preview-section",{attrs:{"is-show-label":!0,"card-width":99,"card-height":65,previews:e.computedColorThemeList,"horizontal-margin":12,"select-first":!1,"is-toggleable":!0,"inital-selected-item-id":e.selectedColorThemeId,"is-svg":!0},on:{select:e.onColorThemeSelect}})],1)])]):e._e()])]),e._v(" "),r("div",{staticClass:"uk-window-body uk-flex uk-flex-column uk-child-separator uk-position-relative"},[r("ul",{staticClass:"uk-switcher uk-height-expand uk-flex uk-flex-column main-content-switcher"},[e.availableTabs.includes("new")?r("skeleton-preview",{ref:"skeletonPreview",staticStyle:{"padding-top":"3px"},attrs:{"show-filter":!1,"select-first":!0,"color-theme-id":e.selectedColorThemeId,"card-width":206,"card-height":127.2,"margin-between":10,"horizontal-margin":26,"is-static-svg":!0},on:{onSelected:function(t){e.selectedTheme=t},onSubmit:e.createFromSelectedTheme}}):e._e(),e._v(" "),e.availableTabs.includes("library")?r("li",{staticClass:"uk-panel uk-height-expand uk-flex uk-flex-column"},[r("preview-section",{attrs:{previews:e.libraryItemsPreviews,"is-show-label":!1,"is-svg":!1,"card-height":127.2,"card-width":206,"margin-between":10,"horizontal-margin":26},on:{select:function(t){e.selectedLibraryId=t},submit:e.createFromLibrary}},["cn"!==e.serviceRegion?r("li",{attrs:{slot:"footer"},slot:"footer"},[r("div",{staticClass:"uk-flex uk-flex-column uk-flex-middle"},[r("a",{staticClass:"uk-button uk-button-link uk-button-icon uk-flex uk-flex-middle uk-card uk-card-default uk-border-rounded uk-flex uk-flex-middle uk-flex-center uk-card-small-shadow",style:{width:"206px",height:"127.2px"},attrs:{draggable:"false",href:"#"},on:{click:function(t){return t.preventDefault(),e.openMoreMaps(t)}}},[r("span",{staticClass:"uk-icon uk-padding-right-xsmall",attrs:{"uk-icon":"icon: external-link"}}),e._v(" "),r("span",{staticClass:"uk-margin-xsmall-left"},[e._v("\n                  "+e._s(e.$T("More Maps"))+"\n                ")])])])]):e._e()])],1):e._e()],1)]),e._v(" "),r("div",{staticClass:"uk-window-button-bar"},[r("ul",{staticClass:"uk-switcher main-content-switcher"},[r("li",[r("div",{staticClass:"uk-button-group"},[r("button",{staticClass:"uk-button uk-button-primary",attrs:{disabled:!e.selectedTheme},on:{click:e.createFromSelectedTheme}},[e._v("\n            "+e._s(e.$T("Create"))+"\n          ")]),e._v(" "),r("button",{staticClass:"uk-button uk-button-default",attrs:{type:"button"},on:{click:e.cancel}},[e._v("\n            "+e._s(e.$T("Cancel"))+"\n          ")])])]),e._v(" "),e.availableTabs.includes("library")?r("li",[r("div",{staticClass:"uk-button-group"},[r("button",{staticClass:"uk-button uk-button-primary",attrs:{type:"submit",disabled:!e.selectedLibraryId||e.isDownloading},on:{click:e.createFromLibrary}},[r("div",{directives:[{name:"show",rawName:"v-show",value:e.isDownloading,expression:"isDownloading"}],attrs:{"uk-spinner":"ratio: 0.4"}}),e._v("\n            "+e._s(e.$T("Open"))+"\n          ")]),e._v(" "),r("button",{staticClass:"uk-button uk-button-default",attrs:{type:"button"},on:{click:e.cancel}},[e._v("\n            "+e._s(e.$T("Cancel"))+"\n          ")])])]):e._e()]),e._v(" "),"new"===e.activeTab?r("div",{staticClass:"uk-button-group"},[r("button",{staticClass:"uk-button uk-button-default",attrs:{type:"button"},on:{click:e.openExistingFile}},[e._v("\n        "+e._s(e.$T("Open File"))+"\n      ")]),e._v(" "),e.isMAS?e._e():r("button",{staticClass:"uk-button uk-button-default",on:{click:e.handleOpenMenu}},[e._v("\n        "+e._s(e.$T("Open Recent"))+"\n      ")])]):e._e()])])}),[],!1,n,"data-v-44129d14",null).exports},3387:(e,t,r)=>{var o=r(38417);o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);(0,r(45346).Z)("fcc8609a",o,!0,{})},76417:e=>{"use strict";e.exports=require("crypto")},58933:e=>{"use strict";e.exports=require("electron")},28614:e=>{"use strict";e.exports=require("events")},35747:e=>{"use strict";e.exports=require("fs")},15720:e=>{"use strict";e.exports=require("ncp")},12087:e=>{"use strict";e.exports=require("os")},85622:e=>{"use strict";e.exports=require("path")},87525:e=>{"use strict";e.exports=require("posthtml")},71191:e=>{"use strict";e.exports=require("querystring")},78835:e=>{"use strict";e.exports=require("url")},31669:e=>{"use strict";e.exports=require("util")}},e=>{"use strict";e.O(0,[8592,5586,4736,2872,7489],(()=>{return t=31952,e(e.s=t);var t}));var t=e.O();module.exports=t}]);