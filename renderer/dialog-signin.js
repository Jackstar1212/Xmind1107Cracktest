(global.webpackChunkxmind_vana=global.webpackChunkxmind_vana||[]).push([[1530],{21906:(e,t,i)=>{"use strict";var s=i(95318);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var n=s(i(59713)),r=s(i(7322)),a=s(i(73850)),o=i(20629);function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function c(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach((function(t){(0,n.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var l={mixins:[r.default,a.default],data:()=>({isMAS:!1}),computed:c(c({touchBarItems(){return[{type:"space",size:"flexible"},{type:"button",label:this.$T("Cancel"),click:"close"},{type:"button",label:this.$T("Sign In"),backgroundColor:"primary",click:"signIn"},{type:"space",size:"flexible"}]}},(0,o.mapGetters)("preferences",["appearance"])),{},{illustrationImageURL(){return this.devices.length?this.$toResourceURL("static/assets/images/unlink-dialog-illustration.svg"):this.$toResourceURL("static/assets/images/signin-dialog-illustration.svg")}}),mounted(){this.updateOpenSignInDialogDate()}};t.Z=l},73850:(e,t,i)=>{"use strict";var s=i(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(i(59713)),r=i(48932),a=i(36414),o=i(99492),u=s(i(41698)),c=s(i(24678)),l=i(95287),d=i(75697);function g(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function v(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?g(Object(i),!0).forEach((function(t){(0,n.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const p=(0,u.default)("mixins-signin"),h=(0,d.parseSearchString)(window.location.search);var f={data(){return{user:"",password:"",isSigningIn:!1,signInError:null,account:null,devices:[],isUnbindingDevices:!1,devicesToUnbind:[],deviceImages:{darwin:this.$toResourceURL("static/images/signin-dialog-device-mac.svg"),win32:this.$toResourceURL("static/images/signin-dialog-device-windows.svg"),linux:this.$toResourceURL("static/images/signin-dialog-device-linux.svg")},signInReferer:"dialog-signin"}},computed:{canSignIn(){return this.user&&this.password&&!this.isSigningIn},canUnbindDevices(){return this.devicesToUnbind.length>0&&!this.isUnbindingDevices}},methods:{signIn(e){if(e&&e.preventDefault&&(e.preventDefault(),e.returnValue=!1),this.canSignIn)return this.$safeRun((()=>this.doSignIn())),!1},async doSignIn(){this.isSigningIn=!0,this.signInError=null;let e,t,i={user:this.user,password:this.password};try{e=await c.default.fetch(o.XOS.SIGN_IN,i)}catch({code:e,message:t,data:i}){return 404===e?this.signInError=i||t:(0,l.showMessageBox)({title:"XMind",message:this.$T("Unable to verify XMind ID."),detail:this.$T("Can't connect with XMind server, please try again later.")}),p.warn("Error while signing in: [%s] '%s'",e||"(no code)",JSON.stringify(i||{})),void(this.isSigningIn=!1)}try{t=await c.default.fetch(o.XOS.DEVICE_BIND,{account:e}),p.debug("Bind device result:",t)}catch(t){return t.code===r.E_DEVICE_UNBOUND?void await this.doSignIn():t.code===r.E_DEVICE_NUMBER_LIMITED&&t.data&&t.data.devices&&(this.devices=t.data.devices.filter((({type:e})=>e in this.deviceImages)),this.devices.length>0)?void(this.account=e):(p.error("Error while binding device:",(0,a.normalizeError)(t)),this.isSigningIn=!1,void(this.signInError=t))}await this.saveAndClose(e,t.rawData)},toggleDeviceToUnbind(e){this.isDeviceToUnbind(e)?this.devicesToUnbind=this.devicesToUnbind.filter((t=>t!==e)):this.devicesToUnbind=this.devicesToUnbind.concat([e])},isDeviceToUnbind(e){return this.devicesToUnbind.includes(e)},getStylesForDeviceDescription(e){return this.isDeviceToUnbind(e)?{opacity:"0.5"}:""},unbindDevices(e){if(e&&e.preventDefault&&(e.preventDefault(),e.returnValue=!1),this.canUnbindDevices)return this.$safeRun((()=>this.doUnbindDevices())),!1},async doUnbindDevices(){let e;try{e=await c.default.fetch(o.XOS.DEVICE_BIND,{account:this.account,unbind:this.devicesToUnbind})}catch(e){return e.code===r.E_DEVICE_NUMBER_LIMITED&&(e.data&&e.data.devices&&(this.devices=e.data.devices.filter((({type:e})=>e in this.deviceImages))),this.devicesToUnbind=[]),void p.error("Unbind devices: ",(0,a.normalizeError)(e))}await this.saveAndClose(this.account,e.rawData)},async saveAndClose(e,t){let i=this.$store.getters["activation/parseSubscriptionData"](t),s={};try{s.subscriptionDetails=await c.default.fetch(o.XOS.SUBSCRIPTION_DETAILS,{account:e})}catch(e){p.warn("Failed to retrieve subscription details:",(0,a.normalizeError)(e))}const n=v(v({},e),{},{rawSubscriptionData:t},s);await Promise.all([c.default.fetch(o.STORE_COMMIT,{mutations:[{type:"account/updateAccount",payload:n}]}),c.default.fetch((0,o.WINDOW_SUBMIT_RESULT)(window.id),{success:!0})]),setTimeout((()=>window.close()),0);const u=this.$store.getters["activation/computeSubscriptionStatus"](i);u===r.SUBSCRIPTION_SERVER_STATUS.VALID||"valid"===u?await c.default.fetch(o.WINDOW_OPEN,{name:"dialog-congratulate"}):u!==r.SUBSCRIPTION_SERVER_STATUS.TRIAL&&u!==r.SUBSCRIPTION_SERVER_STATUS.EXPIRED||h.innerFeatureName||await c.default.fetch(o.WINDOW_OPEN,{name:"dialog-activate"})},updateOpenSignInDialogDate(){this.$store.commit("account/updateOpenSignInDialogDate",new Date)}}};t.default=f},7322:(e,t,i)=>{"use strict";var s=i(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(i(59713)),r=i(48932),a=i(99492),o=i(36414),u=s(i(24678));function c(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?c(Object(i),!0).forEach((function(t){(0,n.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var d={computed:{},watch:{touchBarItems(e){this.updateTouchBarItems(e)}},methods:{updateTouchBarItems(e){const t=e=>{const t=e.click;let i=this._touchBarRoutes[t];return i||(i={method:t,endpoint:(0,a.WINDOW_CALLBACK)(window.id,(0,o.hyphenate)(t))},this._touchBarRoutes[t]=i),i.unroute||(i.unroute=u.default.route(i.endpoint,this[t])),Object.assign({},e,{click:i.endpoint})};e=(e||this.touchBarItems||[]).map((e=>("button"!==e.type||"string"!=typeof e.click||r.WINDOW_ACTIONS.includes(e.click)||e.click.startsWith("command:")?"buttons"===e.type&&(e=l(l({},e),{},{buttons:e.buttons.map((e=>"string"!=typeof e.click||r.WINDOW_ACTIONS.includes(e.click)||e.click.startsWith("command:")?e:t(e)))})):e=t(e),e))),this.$store.commit("window/updateTouchBarItems",{items:e})}},beforeCreate(){this._touchBarRoutes={}},mounted(){this.updateTouchBarItems()},beforeDestroy(){Object.values(this._touchBarRoutes).forEach((({unroute:e})=>e&&e())),this._touchBarRoutes={}}};t.default=d},77590:(e,t,i)=>{"use strict";var s=i(95318),n=s(i(2872)),r=s(i(6430));(0,n.default)(r.default,{name:"dialog-signin"})},75697:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseSearchString=t.toSearchString=void 0;const s=i(71191);t.toSearchString=e=>{const t=s.stringify(e);return t?`?${t}`:""};t.parseSearchString=e=>e.startsWith("?")?s.parse(e.slice(1)):s.parse(e)},6430:(e,t,i)=>{"use strict";i.r(t),i.d(t,{__esModule:()=>s.X,default:()=>n});var s=i(21906);const n=(0,i(62236).Z)(s.Z,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"uk-window uk-window-default uk-window-dialog uk-window-dialog-default"},[i("div",{staticClass:"uk-window-title-bar uk-window-title-bar-floating"},[i("window-control-button-group")],1),e._v(" "),i("div",{staticClass:"uk-window-body uk-flex"},[i("div",{staticClass:"uk-preserve uk-height-1-1 uk-width-auto",attrs:{"data-src":e.illustrationImageURL,"uk-svg":""}}),e._v(" "),i("div",{staticClass:"uk-width-expand uk-margin-large-left uk-margin-xlarge-top uk-margin-large-right uk-margin-large-bottom"},[0===e.devices.length?i("div",{staticClass:"uk-height-1-1 uk-flex uk-flex-column"},[i("h1",{staticClass:"uk-margin-small-bottom"},[e._v("\n          "+e._s(e.$T("Sign In"))+"\n        ")]),e._v(" "),i("div",[e._v("\n          "+e._s(e.$T("Sign in to activate your XMind and share mind maps."))+"\n        ")]),e._v(" "),i("form",{staticClass:"uk-form-stacked uk-margin-large-top",on:{submit:function(t){return t.preventDefault(),e.signIn(t)}}},[i("label",{staticClass:"uk-form-label",attrs:{for:"signin_form_user"}},[e._v(e._s(e.$T("XMind ID/Email:")))]),e._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.user,expression:"user"}],staticClass:"uk-input uk-form-large",attrs:{id:"signin_form_user",type:"text",autofocus:"",disabled:e.isSigningIn},domProps:{value:e.user},on:{input:function(t){t.target.composing||(e.user=t.target.value)}}}),e._v(" "),i("div",{staticClass:"uk-margin-top uk-form-label "},[i("label",{attrs:{for:"signin_form_password"}},[e._v(e._s(e.$T("Password:")))]),e._v(" "),i("a",{staticClass:"uk-text-meta uk-float-right",attrs:{draggable:"false",href:e.isMAS?"xos://GO_ACCOUNT_FORGOT_PASSWORD_MAS":"xos://GO_ACCOUNT_FORGOT_PASSWORD",target:"_blank",tabindex:"1"}},[e._v(e._s(e.$T("Forgot?")))])]),e._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"uk-input uk-form-large",attrs:{id:"signin_form_password",type:"password",disabled:e.isSigningIn},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),e._v(" "),i("p",{staticClass:"uk-text-danger",class:{"uk-invisible":!Boolean(e.signInError)}},[e._v("\n            "+e._s(e.$T("XMind ID not found, or password not match."))+"\n          ")]),e._v(" "),i("button",{staticClass:"uk-button uk-button-primary uk-button-large uk-margin-top uk-width-1-1 uk-flex uk-flex-center uk-flex-middle",attrs:{type:"submit",disabled:!e.canSignIn}},[i("span",{directives:[{name:"show",rawName:"v-show",value:e.isSigningIn,expression:"isSigningIn"}],staticClass:"uk-margin-small-right",attrs:{"uk-spinner":"ratio: 0.6"}}),e._v(" "),i("span",[e._v(e._s(e.$T("Sign In")))])])]),e._v(" "),i("div",{staticClass:"uk-height-expand uk-flex uk-flex-center uk-flex-bottom uk-text-meta"},[e._v("\n          "+e._s(e.$T("New to XMind?")+" ")+"\n          "),i("a",{attrs:{draggable:"false",href:e.isMAS?"xos://GO_ACCOUNT_SIGN_UP_MAS":"xos://GO_ACCOUNT_SIGN_UP",target:"_blank"}},[e._v(e._s(e.$T("Create an account")))])])]):i("form",{staticClass:"uk-height-1-1",on:{submit:function(t){return t.preventDefault(),e.unbindDevices(t)}}},[i("h1",{staticClass:"uk-margin-small-bottom"},[e._v("\n          "+e._s(e.$T("Exceeded Device Limit."))+"\n        ")]),e._v(" "),i("div",[e._v("\n          "+e._s(e.$T("Your account has exceeded device limit. Unlink one device to continue."))+"\n        ")]),e._v(" "),i("div",{staticClass:"uk-margin-small-top"}),e._v(" "),i("div",{staticClass:"uk-overflow-auto uk-padding-remove-left uk-padding-remove-vertical uk-padding-small",staticStyle:{"max-height":"226px"}},e._l(e.devices,(function(t,s){return i("div",{key:s},[i("div",{staticClass:"uk-flex uk-flex-between uk-flex-middle uk-padding-large uk-padding-remove-horizontal "},[i("div",{staticClass:"uk-flex-none uk-background-norepeat uk-background-contain",staticStyle:{width:"56px",height:"42px"},style:e.getStylesForDeviceDescription(t.id),attrs:{"data-src":e.deviceImages[t.type],"uk-svg":""}}),e._v(" "),i("span",{staticClass:"uk-overflow-hidden uk-text-truncate uk-margin-small-left uk-margin-small-right uk-width-1-1",style:e.getStylesForDeviceDescription(t.id),attrs:{title:t.name}},[e._v(e._s(t.name))]),e._v(" "),i("button",{staticClass:"uk-button uk-flex-none uk-button-default",attrs:{type:"button"},on:{click:function(i){return e.toggleDeviceToUnbind(t.id)}}},[e._v("\n                "+e._s(e.isDeviceToUnbind(t.id)?e.$T("Link(verb)"):e.$T("Unlink"))+"\n              ")])]),e._v(" "),s!==e.devices.length-1?i("hr",{staticClass:"uk-margin-remove"}):e._e()])})),0),e._v(" "),i("button",{staticClass:"uk-button uk-button-primary uk-button-large uk-width-1-1 uk-margin-large-top uk-flex uk-flex-center uk-flex-middle",attrs:{type:"submit",disabled:!e.canUnbindDevices}},[i("span",{directives:[{name:"show",rawName:"v-show",value:e.isUnbindingDevices,expression:"isUnbindingDevices"}],staticClass:"uk-margin-small-right",attrs:{"uk-spinner":"ratio: 0.6"}}),e._v(" "),i("span",[e._v(e._s(e.$T("Continue")))])])])])])])}),[],!1,null,null,null).exports},76417:e=>{"use strict";e.exports=require("crypto")},58933:e=>{"use strict";e.exports=require("electron")},28614:e=>{"use strict";e.exports=require("events")},35747:e=>{"use strict";e.exports=require("fs")},12087:e=>{"use strict";e.exports=require("os")},85622:e=>{"use strict";e.exports=require("path")},87525:e=>{"use strict";e.exports=require("posthtml")},71191:e=>{"use strict";e.exports=require("querystring")},31669:e=>{"use strict";e.exports=require("util")}},e=>{"use strict";e.O(0,[8592,5586,4736,2872],(()=>{return t=77590,e(e.s=t);var t}));var t=e.O();module.exports=t}]);