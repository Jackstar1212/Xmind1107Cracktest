(global.webpackChunkxmind_vana=global.webpackChunkxmind_vana||[]).push([[8577],{35792:(t,e,s)=>{"use strict";var i=s(95318);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var n=i(s(71191)),o=s(99492),a=i(s(24678)),r=i(s(61027)),c=i(s(7322)),l=i(s(58331));const{ATTACHED:u,SUMMARY:p,CALLOUT:d,DETACHED:h}=r.default.constant.TOPIC_TYPE,m=n.default.parse(location.search.substring(1));var g={mixins:[c.default],components:{CommonNonePanel:l.default},data:function(){return{searchKey:"",sheets:[],count:0,selectedId:null,topicType:{ATTACHED:u,SUMMARY:p,CALLOUT:d,DETACHED:h},isEmpty:!0,workbookData:[],sheetsId:[],hasTopicLink:!1,checkTwoWayLink:!1,xmindObjectId:null,selected:[]}},computed:{touchBarItems(){return["true"===this.hasTopicLink?{type:"button",label:this.$T("Remove"),click:"remove"}:null,{type:"space",size:"flexible"},{type:"button",label:this.$T("Cancel"),click:"close"},this.selected.length>0&&!this.sheetsId.includes(this.selected[0])?{type:"button",label:this.$T("Insert"),backgroundColor:"primary",click:"_insertTopiclink"}:null,{type:"space",size:"flexible"}].filter(Boolean)},resultTitle:function(){return 0===this.count?this.$T("No Results"):1===this.count?`${this.count} ${this.$T("result")}`:`${this.count} ${this.$T("results")}`},result(){let t=[];if(this.count=0,!this.searchKey)return[];let e=0;for(let s of this.sheets){let i,n=0;if(t.push({value:s.id,type:"sheet",text:s.title,items:[],expanded:!0}),s.rootTopic.children)i=this.walkTopic(s.rootTopic);else{const{id:t,title:e}=s.rootTopic;i=[{value:t,text:e}]}i.forEach((s=>{this.testTitle(t[e].items,s.text,{value:s.value,type:"topic",sheetIndex:e})&&(this.count++,n++)})),0===n?t.pop():e++,n=0}return t},searchIconImage(){return this.$toResourceURL("/static/images/navigation-panel/searchbar-search.svg")},emptyText(){return this.$T("<Empty Text>")}},watch:{searchKey:function(){this.selected=[]}},mounted(){this.selectedIndex=null,this._sheets=JSON.parse(m._sheetsString),this.hasTopicLink=m.hasTopicLink,this.xmindObjectId=m.xmindObjectId,this.$safeRun((()=>{a.default.fetch(o.EDITOR_GET_SHEETS_DATA).then((t=>{this.sheets=JSON.parse(t),this.workbookData=this.caculateWorkbookData(),this.sheetsId=this.workbookData.map((t=>t.value)),this.startKeyListener()}))}))},destroyed(){this.stopKeyListener()},methods:{close:function(){window.close()},treeListKeyDownHandle(t){13==event.keyCode&&this.insertTopiclink(t)},_insertTopiclink(){this.selected.length&&this.$safeRun((async()=>{await a.default.fetch((0,o.WINDOW_SUBMIT_RESULT)(window.id),{action:"set",twoWay:this.checkTwoWayLink,topicId:this.selected[0]}),window.close()}))},insertTopiclink(t){t&&t.preventDefault&&(t.preventDefault(),t.returnValue=!1),this._insertTopiclink()},remove(t){t&&t.preventDefault(),this.$safeRun((async()=>{await a.default.fetch((0,o.WINDOW_SUBMIT_RESULT)(window.id),{action:"remove",topicId:""}),window.close()}))},caculateWorkbookData:function(){let t=this.sheets;if(!t||!t.length)return[];const e=[];return t.forEach((t=>{const{rootTopic:s,id:i}=t,n=this._sheets[this._sheets.findIndex((e=>e.id===t.id))].title,o={value:s.id,text:this.formatTopicTitle(s),items:[],expanded:!0};o.items=this.travelTopics(s),e.push({value:i,text:n,items:[o],expanded:!0})})),this.isEmpty&&(this.isEmpty=!1),e},travelTopics(t,e={items:[]}){const s=this.topicType;if(!t.children)return;let i=t.summaries||[],n=t.children[s.SUMMARY]||[],o=t.children[s.ATTACHED]&&[...t.children[s.ATTACHED]]||[];i.length&&(i.forEach((t=>{const{topicId:e,range:s}=t;n=n.map((t=>(t.id===e&&(t.rangeLastIndex=Number(s.slice(1,s.length-1).split(",")[1])+1),t)))})),n=n.sort(((t,e)=>t.rangeLastIndex-e.rangeLastIndex)).map(((t,e)=>(t.rangeLastIndex+=e,t))),n.forEach((t=>{o.splice(t.rangeLastIndex,0,t)})));const a=[...o,...t.children[s.CALLOUT]||[],...t.children[s.DETACHED]||[]];for(const t of a){const s={value:t.id,text:this.formatTopicTitle(t),items:[],expanded:!0};this.travelTopics(t,s),e.items.push(s)}return e.items},formatTopicTitle(t){return t.image&&t.image.src?`[${this.$T("Image")}] ${t.title}`:t.title},startKeyListener(){window.addEventListener("keydown",this.keydownListener)},stopKeyListener(){window.removeEventListener("keydown",this.keydownListener)},keydownListener(t){13===t.keyCode&&this.treeListKeyDownHandle(t)},walkTopic(t,e=[]){const{id:s,title:i}=t;e.push({value:s,text:i});const n=this.topicType;if(!t.children)return;const o=[...t.children[n.ATTACHED]||[],...t.children[n.SUMMARY]||[],...t.children[n.CALLOUT]||[],...t.children[n.DETACHED]||[]];for(const t of o)this.walkTopic(t,e);return e},testTitle(t,e,s){if(!e)return!1;let i=this.getRegex()[Symbol.search](e);return!(i<0)&&(s.text=e.substring(i-16,i+16),i-16>0&&(s.text="..."+s.text),i+16<e.length&&(s.text+="..."),t.push(s),!0)},getRegex(){return this.createRegExp(this.searchKey,!1,!0,!1)},createRegExp(t,e,s,i){if(!t)return;t=this.escapeRegExpCharacters(t),e&&(/\B/.test(t.charAt(0))||(t="\\b"+t),/\B/.test(t.charAt(t.length-1))||(t+="\\b"));let n="";return s&&(n+="i"),i&&(n+="g"),new RegExp(t,n)},escapeRegExpCharacters:t=>t.replace(/[-\\{}*+?|^$.[\]()#]/g,"\\$&")}};e.Z=g},7322:(t,e,s)=>{"use strict";var i=s(95318);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(s(59713)),o=s(48932),a=s(99492),r=s(36414),c=i(s(24678));function l(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function u(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?l(Object(s),!0).forEach((function(e){(0,n.default)(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):l(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var p={computed:{},watch:{touchBarItems(t){this.updateTouchBarItems(t)}},methods:{updateTouchBarItems(t){const e=t=>{const e=t.click;let s=this._touchBarRoutes[e];return s||(s={method:e,endpoint:(0,a.WINDOW_CALLBACK)(window.id,(0,r.hyphenate)(e))},this._touchBarRoutes[e]=s),s.unroute||(s.unroute=c.default.route(s.endpoint,this[e])),Object.assign({},t,{click:s.endpoint})};t=(t||this.touchBarItems||[]).map((t=>("button"!==t.type||"string"!=typeof t.click||o.WINDOW_ACTIONS.includes(t.click)||t.click.startsWith("command:")?"buttons"===t.type&&(t=u(u({},t),{},{buttons:t.buttons.map((t=>"string"!=typeof t.click||o.WINDOW_ACTIONS.includes(t.click)||t.click.startsWith("command:")?t:e(t)))})):t=e(t),t))),this.$store.commit("window/updateTouchBarItems",{items:t})}},beforeCreate(){this._touchBarRoutes={}},mounted(){this.updateTouchBarItems()},beforeDestroy(){Object.values(this._touchBarRoutes).forEach((({unroute:t})=>t&&t())),this._touchBarRoutes={}}};e.default=p},66711:(t,e,s)=>{"use strict";var i=s(95318),n=i(s(2872)),o=i(s(60627));(0,n.default)(o.default,{name:"dialog-topiclink"})},72236:(t,e,s)=>{"use strict";Object.defineProperty(e,"X",{value:!0});const i=s(90571),n=s(53305);e.Z=i.createComponent({name:"common-none-panel",props:{type:String,containerStyle:{type:String,default:""},sectionStyle:{type:String,default:""},options:{type:Object,default:()=>({})}},setup(t){const e=i.getCurrentInstance(),s=i.computed((()=>({"branch-only":{image:n.toURL("static/images/empty-panel-icon/branch-only.svg"),text:e.$T("It's not available in current mode."),spacing:"1px"},"slide-empty-selection":{image:n.toURL("static/images/empty-panel-icon/slide-empty-selection.svg"),text:e.$T("Select a topic to format."),spacing:"-2px"},"empty-selection":{image:n.toURL("static/images/empty-panel-icon/empty-selection.svg"),text:e.$T("Select an object to format."),spacing:"-2px"},"no-format-available":{image:n.toURL("static/images/empty-panel-icon/no-format-available.svg"),text:e.$T("This object can't be formatted."),spacing:"5px"},"no-note":{image:n.toURL("static/images/empty-panel-icon/no-note.svg"),text:e.$T("No note exists."),spacing:"-3px"},"no-result":{image:n.toURL("static/images/empty-panel-icon/no-result.svg"),text:e.$T("No results found."),spacing:"-1px"},"no-tag":{image:n.toURL("static/images/empty-panel-icon/no-tag.svg"),text:e.$T("No marker or label exists."),spacing:"0px"},"zen-mode-bulb":{image:n.toURL("static/images/empty-panel-icon/zen-mode-bulb.svg"),text:e.$T("Please turn off night mode to enable format options."),spacing:"5px"}}))),o=i.computed((()=>t.type||t.options.type));return{currentImage:i.computed((()=>s.value[o.value].image)),currentText:i.computed((()=>t.text||s.value[o.value].text)),currentSpacing:i.computed((()=>s.value[o.value].spacing))}}})},60627:(t,e,s)=>{"use strict";s.r(e),s.d(e,{__esModule:()=>i.X,default:()=>n});var i=s(35792);const n=(0,s(62236).Z)(i.Z,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"uk-window uk-window-dialog"},[s("div",{staticClass:"uk-window-title-bar uk-window-title-bar-floating"},[s("window-control-button-group")],1),t._v(" "),s("div",{staticClass:"uk-window-body uk-flex uk-flex-row uk-padding uk-flex-column"},[s("div",{staticClass:"topiclink-search"},[s("p",{staticClass:"topiclink-search-title"},[t._v("\n        "+t._s(t.$T("Select a topic to insert link."))+"\n      ")]),t._v(" "),s("div",{staticClass:"uk-position-relative uk-width-1-1 uk-margin-small"},[s("img",{staticClass:"uk-position-absolute",staticStyle:{top:"5px",left:"4px"},attrs:{draggable:"false",src:t.searchIconImage,"uk-svg":""}}),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.searchKey,expression:"searchKey"}],staticClass:"uk-input",staticStyle:{"padding-left":"20px"},attrs:{autofocus:"",type:"text",placeholder:t.$T("Find")},domProps:{value:t.searchKey},on:{input:function(e){e.target.composing||(t.searchKey=e.target.value)}}})])]),t._v(" "),s("div",{staticClass:"uk-background-default uk-height-expand uk-overflow-auto uk-panel uk-panel-scrollable uk-padding-remove uk-text-nowrap"},[t.searchKey||t.isEmpty?t._e():s("tree-list",{attrs:{type:"radio",items:t.workbookData,"focus-value":t.xmindObjectId},scopedSlots:t._u([{key:"item",fn:function(e){var s=e.item;return[t._v("\n          "+t._s(s.text?s.text:t.emptyText)+"\n        ")]}}],null,!1,1116889943),model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}),t._v(" "),t.searchKey&&""!==t.searchKey&&!t.result.length?s("div",{staticClass:"uk-flex uk-height-1-1"},[s("common-none-panel",{attrs:{type:"no-result","container-style":"height: unset;"}})],1):t._e(),t._v(" "),t.searchKey&&""!==t.searchKey&&t.result.length?s("tree-list",{attrs:{type:"radio",items:t.result},scopedSlots:t._u([{key:"item",fn:function(e){var s=e.item;return[t._v("\n          "+t._s(s.text?s.text:t.emptyText)+"\n        ")]}}],null,!1,1116889943),model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}):t._e()],1),t._v(" "),s("div",{staticStyle:{"margin-top":"8px"}},[s("label",[s("input",{staticClass:"uk-checkbox",attrs:{type:"checkbox"},domProps:{checked:t.checkTwoWayLink},on:{change:function(e){t.checkTwoWayLink=!t.checkTwoWayLink}}}),t._v(" "),s("span",{},[t._v(t._s(t.$T("Add Link for Both Topics")))])])])]),t._v(" "),s("div",{staticClass:"uk-window-button-bar"},[s("div",{staticClass:"uk-button-group"},[s("button",{staticClass:"uk-button uk-button-primary",attrs:{type:"button",disabled:!t.selected.length||t.sheetsId.includes(t.selected[0])},on:{click:t.insertTopiclink}},[t._v("\n        "+t._s(t.$T("Insert"))+"\n      ")]),t._v(" "),s("button",{staticClass:"uk-button uk-button-default",attrs:{type:"button"},on:{click:t.close}},[t._v("\n        "+t._s(t.$T("Cancel"))+"\n      ")])]),t._v(" "),"true"===t.hasTopicLink?s("button",{staticClass:"uk-button uk-button-default",on:{click:t.remove}},[t._v("\n      "+t._s(t.$T("Remove"))+"\n    ")]):t._e()])])}),[],!1,null,null,null).exports},58331:(t,e,s)=>{"use strict";s.r(e),s.d(e,{__esModule:()=>i.X,default:()=>n});var i=s(72236);const n=(0,s(62236).Z)(i.Z,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"uk-panel uk-height-expand uk-flex uk-flex-column uk-flex-center uk-width-1-1 uk-common-none-panel",style:t.containerStyle},[s("div",{staticClass:"uk-panel",style:t.sectionStyle},[s("div",{staticClass:"uk-common-none-panel-icon"},[s("img",{staticStyle:{height:"60px",width:"60px"},attrs:{draggable:"false",src:t.currentImage,"uk-svg":""}})]),t._v(" "),s("div",{staticClass:"uk-common-none-panel-text",style:{marginTop:t.currentSpacing}},[t._v("\n      "+t._s(t.currentText)+"\n    ")])])])}),[],!1,null,null,null).exports},76417:t=>{"use strict";t.exports=require("crypto")},58933:t=>{"use strict";t.exports=require("electron")},28614:t=>{"use strict";t.exports=require("events")},35747:t=>{"use strict";t.exports=require("fs")},12087:t=>{"use strict";t.exports=require("os")},85622:t=>{"use strict";t.exports=require("path")},87525:t=>{"use strict";t.exports=require("posthtml")},71191:t=>{"use strict";t.exports=require("querystring")},92413:t=>{"use strict";t.exports=require("stream")},31669:t=>{"use strict";t.exports=require("util")}},t=>{"use strict";t.O(0,[8388,8592,5586,4736,2872],(()=>{return e=66711,t(t.s=e);var e}));var e=t.O();module.exports=e}]);